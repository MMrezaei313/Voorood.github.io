<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم حضور و غیاب شیفت</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/locale/fa.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs-jalali@1.10.2/dayjs-jalali.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --gradient-start: #2c3e50;
            --gradient-end: #4ca1af;
        }
        
        body {
            font-family: 'Vazir', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding-top: 20px;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(25deg);
        }
        
        .card {
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            border: none;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), #1a73e8);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: bold;
            padding: 15px 20px;
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #1a73e8);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #f1c40f);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .table th {
            background: linear-gradient(135deg, var(--secondary-color), #34495e);
            color: white;
            padding: 12px 15px;
        }
        
        .table td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .login-container {
            max-width: 450px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), #1a73e8);
            color: white;
            border: none;
            border-radius: 8px 8px 0 0;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link {
            color: var(--secondary-color);
            border-radius: 8px 8px 0 0;
            padding: 12px 25px;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .persian-date {
            font-family: 'Vazir', sans-serif;
            direction: rtl;
            font-weight: 500;
        }
        
        .status-badge {
            padding: 7px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .koor-header {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-right: 4px solid var(--primary-color);
        }
        
        .print-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, var(--primary-color), #1a73e8);
            color: white;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .print-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .j-date-picker {
            background-color: white;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 10px 15px;
            width: 100%;
        }
        
        .attendance-item {
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .attendance-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stats-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .stats-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .stats-title {
            font-size: 1.1rem;
            color: var(--secondary-color);
            font-weight: 500;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- صفحه ورود -->
        <div id="login-page" v-if="!loggedIn">
            <div class="login-container">
                <h2 class="text-center mb-4">ورود به سیستم حضور و غیاب</h2>
                <form @submit.prevent="login">
                    <div class="mb-3">
                        <label for="username" class="form-label">نام کاربری</label>
                        <input type="text" class="form-control" id="username" v-model="loginData.username" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">رمز عبور</label>
                        <input type="password" class="form-control" id="password" v-model="loginData.password" required>
                    </div>
                    <div class="mb-3">
                        <label for="role" class="form-label">نقش کاربری</label>
                        <select class="form-select" id="role" v-model="loginData.role" required>
                            <option value="admin">ادمین</option>
                            <option value="supervisor">سرپرست شیفت</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">ورود به سیستم</button>
                </form>
            </div>
        </div>

        <!-- صفحه اصلی بعد از ورود -->
        <div id="main-page" v-else>
            <!-- هدر -->
            <div class="header text-center">
                <h1>سیستم حضور و غیاب شیفت</h1>
                <p class="mb-2">کاربر: {{ currentUser.name }} ({{ currentUser.role === 'admin' ? 'ادمین' : 'سرپرست شیفت' }})</p>
                <p class="persian-date">امروز: {{ currentJalaliDate }}</p>
                <button class="btn btn-light btn-sm no-print" @click="logout">خروج</button>
            </div>

            <!-- آمار کلی -->
            <div class="row no-print">
                <div class="col-md-3">
                    <div class="stats-box">
                        <div class="stats-title">تعداد پرسنل</div>
                        <div class="stats-number">{{ personnels.length }}</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-box">
                        <div class="stats-title">ثبت‌های امروز</div>
                        <div class="stats-number">{{ todayRecordsCount }}</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-box">
                        <div class="stats-title">حاضران</div>
                        <div class="stats-number">{{ presentCount }}</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-box">
                        <div class="stats-title">مرخصی</div>
                        <div class="stats-number">{{ leaveCount }}</div>
                    </div>
                </div>
            </div>

            <!-- تب‌ها -->
            <ul class="nav nav-tabs mb-4 no-print" id="myTab" role="tablist">
                <li class="nav-item" role="presentation" v-if="currentUser.role === 'admin'">
                    <button class="nav-link" :class="{ active: activeTab === 'personnel' }" @click="activeTab = 'personnel'">
                        <i class="bi bi-people-fill me-2"></i>مدیریت پرسنل
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" :class="{ active: activeTab === 'attendance' }" @click="activeTab = 'attendance'">
                        <i class="bi bi-clipboard-check-fill me-2"></i>ثبت حضور و غیاب
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" :class="{ active: activeTab === 'reports' }" @click="activeTab = 'reports'">
                        <i class="bi bi-graph-up me-2"></i>گزارشات
                    </button>
                </li>
            </ul>

            <!-- مدیریت پرسنل (فقط برای ادمین) -->
            <div v-if="activeTab === 'personnel' && currentUser.role === 'admin'" class="tab-pane fade show active">
                <div class="card">
                    <div class="card-header">مدیریت پرسنل</div>
                    <div class="card-body">
                        <form @submit.prevent="addPersonnel" class="mb-4">
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="name" class="form-label">نام</label>
                                    <input type="text" class="form-control" id="name" v-model="newPersonnel.name" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="family" class="form-label">نام خانوادگی</label>
                                    <input type="text" class="form-control" id="family" v-model="newPersonnel.family" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="personnelCode" class="form-label">شماره پرسنلی</label>
                                    <input type="text" class="form-control" id="personnelCode" v-model="newPersonnel.personnelCode" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="position" class="form-label">پست سازمانی</label>
                                    <select class="form-select" id="position" v-model="newPersonnel.position" required>
                                        <option v-for="(positions, koor) in koorPositions" :key="koor">
                                            <optgroup :label="koor">
                                                <option v-for="position in positions" :value="position">{{ position }}</option>
                                            </optgroup>
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success mt-3">
                                <i class="bi bi-person-plus-fill me-2"></i>افزودن پرسنل
                            </button>
                        </form>

                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>شماره پرسنلی</th>
                                        <th>نام و نام خانوادگی</th>
                                        <th>پست سازمانی</th>
                                        <th>عملیات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="personnel in personnels" :key="personnel.id">
                                        <td>{{ personnel.personnelCode }}</td>
                                        <td>{{ personnel.name }} {{ personnel.family }}</td>
                                        <td>{{ personnel.position }}</td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" @click="deletePersonnel(personnel.id)">
                                                <i class="bi bi-trash-fill me-1"></i>حذف
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ثبت حضور و غیاب -->
            <div v-if="activeTab === 'attendance'" class="tab-pane fade show active">
                <div class="card">
                    <div class="card-header">ثبت حضور و غیاب شیفت</div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label for="shiftDate" class="form-label">تاریخ</label>
                                <input type="date" class="form-control" id="shiftDate" v-model="attendanceData.date" required>
                                <div class="persian-date mt-2">{{ jalaliDate }}</div>
                            </div>
                            <div class="col-md-4">
                                <label for="shiftType" class="form-label">نوع شیفت</label>
                                <select class="form-select" id="shiftType" v-model="attendanceData.shiftType" required>
                                    <option value="صبح (۶-۱۴)">صبح (۶-۱۴)</option>
                                    <option value="عصر (۱۴-۲۲)">عصر (۱۴-۲۲)</option>
                                    <option value="شب (۲۲-۶)">شب (۲۲-۶)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="supervisor" class="form-label">سرپرست شیفت</label>
                                <input type="text" class="form-control" id="supervisor" v-model="attendanceData.supervisor" required>
                            </div>
                        </div>

                        <div v-for="(positions, koor) in koorPositions" :key="koor">
                            <div class="koor-header">{{ koor }}</div>
                            <div class="mb-3" v-for="position in positions" :key="position">
                                <label class="form-label">{{ position }}</label>
                                <div v-for="(attendance, index) in getAttendanceByPosition(position)" :key="index" class="p-3 border rounded attendance-item mb-2">
                                    <div class="row align-items-center">
                                        <div class="col-md-4">
                                            <select class="form-select" v-model="attendance.personnelId" @change="updateAttendancePersonnel(attendance, $event)">
                                                <option value="">انتخاب پرسنل</option>
                                                <option v-for="p in getPersonnelByPosition(position)" :value="p.id" :key="p.id">{{ p.name }} {{ p.family }} ({{ p.personnelCode }})</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" :name="'status_' + attendance.id" value="present" v-model="attendance.status">
                                                <label class="form-check-label">حاضر</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" :name="'status_' + attendance.id" value="leave" v-model="attendance.status">
                                                <label class="form-check-label">مرخصی</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" v-model="attendance.overtime">
                                                <label class="form-check-label">اضافه کار</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" v-model="attendance.substitute" @change="toggleSubstitute(attendance)">
                                                <label class="form-check-label">تعویض</label>
                                            </div>
                                            <div v-if="attendance.substitute" class="mt-2">
                                                <input type="text" class="form-control form-control-sm" placeholder="با چه کسی تعویض شده؟" v-model="attendance.substituteWith">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary mt-2 no-print" @click="addAnotherPersonnel(position)">
                                    <i class="bi bi-plus-circle me-1"></i>افزودن پرسنل دیگر برای این پست
                                </button>
                            </div>
                        </div>

                        <button class="btn btn-success mt-4 no-print" @click="saveAttendance">
                            <i class="bi bi-check-circle-fill me-2"></i>ذخیره اطلاعات حضور و غیاب
                        </button>
                    </div>
                </div>
            </div>

            <!-- گزارشات -->
            <div v-if="activeTab === 'reports'" class="tab-pane fade show active">
                <div class="card">
                    <div class="card-header">گزارشات حضور و غیاب</div>
                    <div class="card-body">
                        <div class="row mb-4 no-print">
                            <div class="col-md-3">
                                <label for="startDate" class="form-label">از تاریخ</label>
                                <input type="date" class="form-control" id="startDate" v-model="reportData.startDate">
                            </div>
                            <div class="col-md-3">
                                <label for="endDate" class="form-label">تا تاریخ</label>
                                <input type="date" class="form-control" id="endDate" v-model="reportData.endDate">
                            </div>
                            <div class="col-md-3">
                                <label for="reportShift" class="form-label">شیفت</label>
                                <select class="form-select" id="reportShift" v-model="reportData.shiftType">
                                    <option value="">همه شیفت‌ها</option>
                                    <option value="صبح (۶-۱۴)">صبح (۶-۱۴)</option>
                                    <option value="عصر (۱۴-۲۲)">عصر (۱۴-۲۲)</option>
                                    <option value="شب (۲۲-۶)">شب (۲۲-۶)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label d-block">&nbsp;</label>
                                <button class="btn btn-primary" @click="generateReport">
                                    <i class="bi bi-file-earmark-bar-graph me-2"></i>تولید گزارش
                                </button>
                                <button class="btn btn-success ms-2" @click="exportPDF" v-if="reportResults.length">
                                    <i class="bi bi-file-earmark-pdf me-2"></i>خروجی PDF
                                </button>
                            </div>
                        </div>

                        <div class="print-section" v-if="reportResults.length">
                            <div class="report-header text-center mb-4">
                                <h3>گزارش حضور و غیاب پرسنل</h3>
                                <p class="persian-date">تاریخ گزارش: {{ currentJalaliDate }}</p>
                                <p v-if="reportData.startDate || reportData.endDate">
                                    بازه زمانی: 
                                    {{ reportData.startDate ? toJalali(reportData.startDate) : 'شروع' }} 
                                    تا 
                                    {{ reportData.endDate ? toJalali(reportData.endDate) : 'پایان' }}
                                </p>
                                <p v-if="reportData.shiftType">شیفت: {{ reportData.shiftType }}</p>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th>تاریخ</th>
                                            <th>شیفت</th>
                                            <th>پرسنل</th>
                                            <th>پست سازمانی</th>
                                            <th>وضعیت</th>
                                            <th>اضافه کار</th>
                                            <th>تعویض با</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(item, index) in reportResults" :key="index">
                                            <td>{{ toJalali(item.date) }}</td>
                                            <td>{{ item.shiftType }}</td>
                                            <td>{{ item.personnelName }}</td>
                                            <td>{{ item.position }}</td>
                                            <td>
                                                <span class="status-badge" :class="{
                                                    'bg-success': item.status === 'present',
                                                    'bg-warning': item.status === 'leave'
                                                }">
                                                    {{ item.status === 'present' ? 'حاضر' : 'مرخصی' }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge bg-info" v-if="item.overtime">اضافه کار</span>
                                                <span v-else>-</span>
                                            </td>
                                            <td>{{ item.substituteWith || '-' }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div v-else class="alert alert-info no-print">
                            <i class="bi bi-info-circle me-2"></i> گزارشی برای نمایش وجود ندارد. لطفا فیلترهای مورد نظر خود را اعمال کنید.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- دکمه پرینت -->
            <div class="print-btn no-print" @click="printPage" title="چاپ گزارش">
                <i class="bi bi-printer-fill"></i>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.js"></script>
    <script>
        const { createApp, ref, reactive, computed, onMounted } = Vue;
        
        createApp({
            setup() {
                // وضعیت ورود کاربر
                const loggedIn = ref(false);
                const currentUser = ref({});
                const activeTab = ref('attendance');
                
                // داده‌های ورود
                const loginData = reactive({
                    username: '',
                    password: '',
                    role: 'admin'
                });
                
                // داده‌های پرسنل
                const personnels = ref([]);
                const newPersonnel = reactive({
                    name: '',
                    family: '',
                    personnelCode: '',
                    position: ''
                });
                
                // داده‌های حضور و غیاب
                const attendanceData = reactive({
                    date: new Date().toISOString().split('T')[0],
                    shiftType: 'صبح (۶-۱۴)',
                    supervisor: ''
                });
                
                const attendanceRecords = ref([]);
                
                // داده‌های گزارش
                const reportData = reactive({
                    startDate: '',
                    endDate: '',
                    shiftType: ''
                });
                
                const reportResults = ref([]);
                
                // تعریف پست‌های سازمانی
                const koorPositions = {
                    "کوره یک": [
                        "ذوبکار کوره یک",
                        "متصدی ماشین خط یک",
                        "متصدی لهر خط یک",
                        "متصدی برش و شیشه گیری خط یک"
                    ],
                    "کوره دو": [
                        "ذوبکار کوره دو",
                        "متصدی ماشین خط دو",
                        "متصدی ماشین خط سه",
                        "متصدی لهر خط دو",
                        "متصدی لهر خط سه",
                        "متصدی برش خط دو و سه",
                        "شیشه گیری خط دو و سه"
                    ]
                };
                
                // تاریخ شمسی
                const currentJalaliDate = computed(() => {
                    return toJalali(new Date().toISOString().split('T')[0]);
                });
                
                const jalaliDate = computed(() => {
                    return toJalali(attendanceData.date);
                });
                
                function toJalali(gregorianDate) {
                    if (!gregorianDate) return '';
                    const [year, month, day] = gregorianDate.split('-');
                    const jDate = dayjs(`${year}-${month}-${day}`).calendar('jalali').locale('fa');
                    return jDate.format('jYYYY/jMM/jDD');
                }
                
                // آمار
                const todayRecordsCount = computed(() => {
                    const today = new Date().toISOString().split('T')[0];
                    return attendanceRecords.value.filter(record => record.date === today).length;
                });
                
                const presentCount = computed(() => {
                    return attendanceRecords.value.filter(record => record.status === 'present').length;
                });
                
                const leaveCount = computed(() => {
                    return attendanceRecords.value.filter(record => record.status === 'leave').length;
                });
                
                // توابع مربوط به ورود و خروج
                const login = () => {
                    // در حالت واقعی باید با سرور چک شود
                    if (loginData.username && loginData.password) {
                        currentUser.value = {
                            name: loginData.username,
                            role: loginData.role
                        };
                        loggedIn.value = true;
                        
                        // بارگذاری داده‌های ذخیره شده
                        loadFromLocalStorage();
                    }
                };
                
                const logout = () => {
                    loggedIn.value = false;
                    currentUser.value = {};
                    loginData.username = '';
                    loginData.password = '';
                    loginData.role = 'admin';
                };
                
                // توابع مدیریت پرسنل
                const addPersonnel = () => {
                    const newId = Date.now().toString();
                    personnels.value.push({
                        id: newId,
                        name: newPersonnel.name,
                        family: newPersonnel.family,
                        personnelCode: newPersonnel.personnelCode,
                        position: newPersonnel.position
                    });
                    
                    // ریست فرم
                    newPersonnel.name = '';
                    newPersonnel.family = '';
                    newPersonnel.personnelCode = '';
                    newPersonnel.position = '';
                    
                    saveToLocalStorage();
                };
                
                const deletePersonnel = (id) => {
                    personnels.value = personnels.value.filter(p => p.id !== id);
                    saveToLocalStorage();
                };
                
                const getPersonnelByPosition = (position) => {
                    return personnels.value.filter(p => p.position === position);
                };
                
                // توابع حضور و غیاب
                const getAttendanceByPosition = (position) => {
                    return attendanceRecords.value.filter(a => a.position === position && a.date === attendanceData.date && a.shiftType === attendanceData.shiftType);
                };
                
                const addAnotherPersonnel = (position) => {
                    attendanceRecords.value.push({
                        id: Date.now().toString(),
                        date: attendanceData.date,
                        shiftType: attendanceData.shiftType,
                        position: position,
                        personnelId: '',
                        status: 'present',
                        overtime: false,
                        substitute: false,
                        substituteWith: ''
                    });
                };
                
                const updateAttendancePersonnel = (attendance, event) => {
                    const personnelId = event.target.value;
                    const personnel = personnels.value.find(p => p.id === personnelId);
                    
                    if (personnel) {
                        attendance.personnelName = `${personnel.name} ${personnel.family}`;
                    }
                };
                
                const toggleSubstitute = (attendance) => {
                    if (!attendance.substitute) {
                        attendance.substituteWith = '';
                    }
                };
                
                const saveAttendance = () => {
                    // ذخیره اطلاعات حضور و غیاب
                    saveToLocalStorage();
                    alert('اطلاعات حضور و غیاب با موفقیت ذخیره شد.');
                };
                
                // توابع گزارش‌گیری
                const generateReport = () => {
                    let results = [...attendanceRecords.value];
                    
                    // فیلتر بر اساس تاریخ
                    if (reportData.startDate) {
                        results = results.filter(r => r.date >= reportData.startDate);
                    }
                    
                    if (reportData.endDate) {
                        results = results.filter(r => r.date <= reportData.endDate);
                    }
                    
                    // فیلتر بر اساس شیفت
                    if (reportData.shiftType) {
                        results = results.filter(r => r.shiftType === reportData.shiftType);
                    }
                    
                    // افزودن اطلاعات پرسنل
                    results = results.map(record => {
                        const personnel = personnels.value.find(p => p.id === record.personnelId);
                        return {
                            ...record,
                            personnelName: personnel ? `${personnel.name} ${personnel.family}` : 'نامشخص'
                        };
                    });
                    
                    reportResults.value = results;
                };
                
                const exportPDF = () => {
                    // در اینجا کد تولید PDF قرار می‌گیرد
                    alert('امکان خروجی PDF در نسخه نمایشی فعال نیست. در نسخه کامل پیاده‌سازی خواهد شد.');
                };
                
                // چاپ صفحه
                const printPage = () => {
                    window.print();
                };
                
                // توابع ذخیره و بازیابی از localStorage
                const saveToLocalStorage = () => {
                    localStorage.setItem('personnels', JSON.stringify(personnels.value));
                    localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords.value));
                };
                
                const loadFromLocalStorage = () => {
                    const savedPersonnels = localStorage.getItem('personnels');
                    const savedAttendance = localStorage.getItem('attendanceRecords');
                    
                    if (savedPersonnels) {
                        personnels.value = JSON.parse(savedPersonnels);
                    }
                    
                    if (savedAttendance) {
                        attendanceRecords.value = JSON.parse(savedAttendance);
                    }
                };
                
                // مقداردهی اولیه
                onMounted(() => {
                    dayjs.locale('fa');
                    
                    // ایجاد برخی داده‌های نمونه برای نمایش
                    if (localStorage.getItem('personnels') === null) {
                        personnels.value = [
                            { id: '1', name: 'علی', family: 'رضایی', personnelCode: '1001', position: 'ذوبکار کوره یک' },
                            { id: '2', name: 'محمد', family: 'محمدی', personnelCode: '1002', position: 'متصدی ماشین خط یک' },
                            { id: '3', name: 'حسن', family: 'حسینی', personnelCode: '1003', position: 'ذوبکار کوره دو' },
                            { id: '4', name: 'رضا', family: 'کریمی', personnelCode: '1004', position: 'متصدی برش خط دو و سه' }
                        ];
                    }
                    
                    if (localStorage.getItem('attendanceRecords') === null) {
                        attendanceRecords.value = [];
                    }
                    
                    // تنظیم تاریخ پیش‌فرض برای گزارش به ۷ روز گذشته
                    const sevenDaysAgo = new Date();
                    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                    reportData.startDate = sevenDaysAgo.toISOString().split('T')[0];
                    reportData.endDate = new Date().toISOString().split('T')[0];
                });
                
                return {
                    loggedIn,
                    currentUser,
                    activeTab,
                    loginData,
                    personnels,
                    newPersonnel,
                    attendanceData,
                    reportData,
                    reportResults,
                    koorPositions,
                    currentJalaliDate,
                    jalaliDate,
                    todayRecordsCount,
                    presentCount,
                    leaveCount,
                    login,
                    logout,
                    addPersonnel,
                    deletePersonnel,
                    getPersonnelByPosition,
                    getAttendanceByPosition,
                    addAnotherPersonnel,
                    updateAttendancePersonnel,
                    toggleSubstitute,
                    saveAttendance,
                    generateReport,
                    exportPDF,
                    printPage,
                    toJalali
                };
            }
        }).mount('#app');
    </script>
</body>
</html>